const log4js = require('log4js');
const log4js_extend = require("log4js-extend")
const fs = require('fs');

console.log("jlog.js's path: " + __dirname);
const logsPath = __dirname + '/logs'
console.log("logs path: " + logsPath);

log4js_extend(log4js, {
    path: __dirname,
    format: "[@name (@file:@line:@column)]"
});

if (!fs.existsSync(logsPath)) {
    console.log("Not found logs folder. Creat new folder.");
    fs.mkdirSync(logsPath);
} else {
    console.log("Found logs folder.");
}


module.exports = (category) => {

    // log4js使わない場合
    // return {
    //     info: (tmp) => {
    //         console.log(tmp)
    //     }
    // }

    log4js.configure({
        appenders: [
            {
                "type": "dateFile",
                "category": category,
                "filename": logsPath + "/request.log",
                "pattern": "-yyyy-MM-dd"
            },
            {
                "type": "console",
                "category": category,
                "filename": logsPath + "/request.log",
                "pattern": "-yyyy-MM-dd"
            }
        ]
    });

    return log4js.getLogger(category)
}

// [type]
// file	ファイルに書き出す。
// datefile	日付毎にローテーションしてファイルに書き出す。
// console	コンソールに書き出す。